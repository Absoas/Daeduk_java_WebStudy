<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.board.dao.IBoardDAO">
   <sql id="searchFrag">
      <trim prefix=" WHERE " suffixOverrides=" AND|OR ">
         <if test="searchVO!=null">
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchVO.bo_writer)">
               BO_WRITER LIKE '%'||#{searchVO.bo_writer}||'%' OR
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchVO.bo_title)">
               BO_TITLE LIKE '%'||#{searchVO.bo_title}||'%' OR
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchVO.bo_content)">
               BO_CONTENT LIKE '%'||#{searchVO.bo_content}||'%' OR
            </if>
         </if>
      </trim>
   </sql>
   <select id="selectTotalRecord" parameterType="pagingVO" resultType="long">
      SELECT NVL(COUNT(*), 0)
      FROM BOARD
      <include refid="searchFrag" />
   </select>
   <select id="selectBoardList" parameterType="pagingVO" resultType="boardVO">
      SELECT B.*
      FROM (
          SELECT ROWNUM RNUM, A.*
          FROM (
              SELECT BO_NO, BO_TITLE, BO_WRITER, BO_DATE, 
                      BO_HIT, BO_RCMD
              FROM BOARD
              <include refid="searchFrag" />
              ORDER BY BO_NO DESC
          ) A ) B
      WHERE RNUM BETWEEN #{startRow} AND #{endRow}
   </select>
   
   <resultMap type="boardVO" id="boardMap" autoMapping="true">
      <id property="bo_no" column="BO_NO"/>
      <collection property="pdsList" ofType="pdsVO" autoMapping="true"></collection>
   </resultMap>
   <select id="selectBoard" parameterType="long" resultMap="boardMap">
      SELECT BOARD.BO_NO, BO_WRITER, BO_IP, BO_MAIL, BO_TITLE, BO_CONTENT,
         BO_DATE, BO_HIT, BO_RCMD , PDS_NO, PDS_SAVENAME, PDS_FILENAME, PDS_SIZE, PDS_FANCYSIZE,
         PDS_MIME
      FROM BOARD LEFT OUTER JOIN PDS ON (BOARD.BO_NO = PDS.BO_NO)
      WHERE BOARD.BO_NO = #{bo_no}
   </select>
   
   <update id="incrementHit" parameterType="long">
      UPDATE BOARD
      SET
      BO_HIT = BO_HIT + 1
      WHERE BO_NO = #{bo_no}
   </update>
   
   <insert id="insertBoard" parameterType="boardVO">
      <selectKey order="BEFORE" keyProperty="bo_no" resultType="long">
         SELECT BOARD_SEQ.NEXTVAL FROM DUAL
      </selectKey>
      INSERT INTO board(BO_NO,BO_WRITER,BO_PASS,BO_IP,BO_MAIL,BO_TITLE,BO_CONTENT,BO_DATE,BO_HIT,BO_RCMD)
      VALUES(#{bo_no},#{bo_writer},#{bo_pass},#{bo_ip},#{bo_mail},#{bo_title},#{bo_content},sysdate,0,0)
   </insert>
   
</mapper>

